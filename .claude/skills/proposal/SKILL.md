---
name: proposal
description: 生成提案文档。当用户需要规划新功能、生成需求文档、设计文档、API文档、测试用例时使用。触发词：提案、需求、设计、规划功能、新功能。
---

# /proposal - 生成提案文档

## 描述

分析用户需求，生成完整的提案文档，包括需求、设计、API、测试用例和任务清单。

**模式**：Plan 模式（需要人机交互确认）

---

## 执行流程

### Step 0: 项目识别

根据项目自动识别技术栈，如果无法识别（或者空项目），则引导用户一起设计技术栈。

---

### Step 1: 需求澄清

1. 分析用户输入的需求描述
2. 识别以下信息：
   - 核心功能点
   - 业务场景
   - 可能的约束条件
3. 提出澄清问题（如果需求不明确）
4. **等待用户确认后继续**

---

### Step 2: 创建提案目录

```bash
# 创建目录（feature-name 从需求中提取，使用英文短横线连接）
mkdir -p .proposal/{feature-name}
```

---

### Step 3: 生成需求文档 (1-requirements.md)

读取同目录下的 `requirements.template.md` 模板，生成需求文档。

**必须包含的内容**：

1. **功能概述**：一句话描述
2. **功能要求 (FR)**：
   - 拆解为具体的功能点
   - 每个功能点有明确的验收标准
   - 标注优先级 (P0/P1/P2)
3. **非功能要求 (NFR)**：
   - 性能指标
   - 安全要求
   - 可用性要求
4. **约束与假设**
5. **待确认项**：所有不确定的内容标记 `[待确认]`

**质量检查**：
- [ ] 功能要求覆盖用户需求的所有点
- [ ] 每个 FR 都有验收标准
- [ ] NFR 包含性能、安全指标
- [ ] 待确认项已标记

---

### Step 4: 生成设计文档 (2-design.md)

读取同目录下的 `design.template.md` 模板，生成设计文档。

**必须包含的内容**：

1. **设计概述**：目标和范围
2. **架构设计**：
   - 涉及的层和组件
   - 组件交互关系
3. **数据模型**：
   - 后端：Entity/Model 定义
   - 前端：TypeScript interface/type
4. **核心流程**：
   - 主流程图
   - 异常处理
5. **技术决策**：备选方案和最终决定
6. **安全考虑**
7. **性能考虑**

**质量检查**：
- [ ] 架构图与项目类型匹配
- [ ] 数据模型完整
- [ ] 核心流程明确
- [ ] 技术决策有理由
- [ ] 异常处理已设计

---

### Step 5: 生成 API 文档 (3-api-spec.md)

读取同目录下的 `api-spec.template.md` 模板，生成 API 接口文档。

对每个端点设计：

1. **基本信息**
   - HTTP 方法 (GET/POST/PUT/DELETE)
   - URL 路径（遵循 RESTful 规范）
   - 功能描述

2. **请求参数**
   - Path 参数
   - Query 参数
   - Body 参数
   - 每个参数的类型、是否必填、校验规则

3. **响应格式**
   - 成功响应结构
   - 响应字段说明

4. **错误码**
   - 可能的错误场景
   - 对应的错误码和错误信息

**质量检查**：
- [ ] URL 路径符合 RESTful 规范
- [ ] 所有参数都有类型和说明
- [ ] 必填/选填标注清晰
- [ ] 校验规则明确
- [ ] 所有可能的错误码都已列出
- [ ] 有请求/响应示例
- [ ] 与项目现有 API 风格一致

---

### Step 6: 生成测试用例 (4-test-cases.md)

读取同目录下的 `test-cases.template.md` 模板，生成测试用例文档。

**单元测试 (UT-*)**：
- 测试 Service 层业务逻辑
- 覆盖正常路径、异常路径、边界条件

**API 测试 (AT-*)**：
- 测试 Controller 层接口
- 覆盖成功场景、参数校验、业务异常、权限控制

**质量检查**：
- [ ] 每个 FR 都有对应的测试用例
- [ ] 每个 API 都有正常+异常测试
- [ ] 参数校验规则都有对应测试
- [ ] 所有错误码都有触发场景
- [ ] 边界值都已测试

---

### Step 7: 生成任务清单 (5-tasks.md)

读取同目录下的 `tasks.template.md` 模板，生成任务清单：
- 从设计文档提取编码任务
- 从测试用例文档提取测试任务
- 添加验证任务

---

## 输出

完成后显示：

```
✅ 提案生成完成：{feature-name}

📁 文档位置：.proposal/{feature-name}/
├── 1-requirements.md   (需求文档)
├── 2-design.md         (设计文档)
├── 3-api-spec.md       (API文档)
├── 4-test-cases.md     (测试用例)
└── 5-tasks.md          (任务清单)

📋 摘要：
- 功能要求: X 项
- API 接口: X 个
- 测试用例: UT-X 个, AT-X 个
- 开发任务: X 个

⚠️ 待确认项: X 个

👉 下一步:
   1. 检查文档，确认待确认项
   2. 执行 /apply {feature-name} 开始实现
```

---

## 参数

- `$ARGUMENTS`：用户需求描述

**示例**：
```
/proposal 实现用户注册功能，支持邮箱和密码注册
/proposal 添加订单查询接口，支持按时间范围和状态筛选
```

---

## 注意事项

1. **不要猜测**：不确定的内容标记 `[待确认]`
2. **参考现有代码**：保持与项目风格一致
3. **渐进式生成**：每个文档生成后可以与用户确认
4. **质量优先**：宁可多问，不要假设
5. **用户通知**：需要用户输入或确认时，发送系统通知

---

## 用户通知

当需要用户介入时（需求澄清、文档确认、待确认项处理），发送系统通知：

```bash
# macOS
osascript -e 'display notification "需要您的输入" with title "AI Workflow" sound name "Ping"'

# Linux
notify-send "AI Workflow" "需要您的输入"
```
